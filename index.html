<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }


        #root {
            width: 2000px;
            height: 1000px;
            display: flex;
        }

        .line {
            display: inline-block;
            box-sizing: border-box;
            width: 30px;
            position: relative;
        }

        .line-info {
            position: absolute;
            bottom: -30px;
            width: 30px;
            font-size: 20px;
            text-align: center;
        }

        .note {
            display: block;
            width: 100%;
            height: 20px;
            background-color: black;
            animation: up linear 4s none;
            position: absolute;
            top: 100%;
            visibility: hidden;
        }

        @keyframes up {
            0% {
                top: 100%;
                visibility: visible;
            }

            100% {
                top: 0;
                visibility: hidden;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/15.1.3/Tone.js"></script>
</head>

<body>
    <div id="root">

    </div>
    <script>
        const sampler = new Tone.Sampler({
            urls: {
                "A0": "./sound/1.mp3",
                "A#0": "./sound/2.mp3",
                "B0": "./sound/3.mp3",
                "C1": "./sound/4.mp3",
                "C#1": "./sound/5.mp3",
                "D1": "./sound/6.mp3",
                "D#1": "./sound/7.mp3",
                "E1": "./sound/8.mp3",
                "F1": "./sound/9.mp3",
                "F#1": "./sound/10.mp3",
                "G1": "./sound/11.mp3",
                "G#1": "./sound/12.mp3",
                "A1": "./sound/13.mp3",
                "A#1": "./sound/14.mp3",
                "B1": "./sound/15.mp3",
                "C2": "./sound/16.mp3",
                "C#2": "./sound/17.mp3",
                "D2": "./sound/18.mp3",
                "D#2": "./sound/19.mp3",
                "E2": "./sound/20.mp3",
                "F2": "./sound/21.mp3",
                "F#2": "./sound/22.mp3",
                "G2": "./sound/23.mp3",
                "G#2": "./sound/24.mp3",
                "A2": "./sound/25.mp3",
                "A#2": "./sound/26.mp3",
                "B2": "./sound/27.mp3",
                "C3": "./sound/28.mp3",
                "C#3": "./sound/29.mp3",
                "D3": "./sound/30.mp3",
                "D#3": "./sound/31.mp3",
                "E3": "./sound/32.mp3",
                "F3": "./sound/33.mp3",
                "F#3": "./sound/34.mp3",
                "G3": "./sound/35.mp3",
                "G#3": "./sound/36.mp3",
                "A3": "./sound/37.mp3",
                "A#3": "./sound/38.mp3",
                "B3": "./sound/39.mp3",
                "C4": "./sound/40.mp3",
                "C#4": "./sound/41.mp3",
                "D4": "./sound/42.mp3",
                "D#4": "./sound/43.mp3",
                "E4": "./sound/44.mp3",
                "F4": "./sound/45.mp3",
                "F#4": "./sound/46.mp3",
                "G4": "./sound/47.mp3",
                "G#4": "./sound/48.mp3",
                "A4": "./sound/49.mp3",
                "A#4": "./sound/50.mp3",
                "B4": "./sound/51.mp3",
                "C5": "./sound/52.mp3",
                "C#5": "./sound/53.mp3",
                "D5": "./sound/54.mp3",
                "D#5": "./sound/55.mp3",
                "E5": "./sound/56.mp3",
                "F5": "./sound/57.mp3",
                "F#5": "./sound/58.mp3",
                "G5": "./sound/59.mp3",
                "G#5": "./sound/60.mp3",
                "A5": "./sound/61.mp3",
                "A#5": "./sound/62.mp3",
                "B5": "./sound/63.mp3",
                "C6": "./sound/64.mp3",
                "C#6": "./sound/65.mp3",
                "D6": "./sound/66.mp3",
                "D#6": "./sound/67.mp3",
                "E6": "./sound/68.mp3",
                "F6": "./sound/69.mp3",
                "F#6": "./sound/70.mp3",
                "G6": "./sound/71.mp3",
                "G#6": "./sound/72.mp3",
                "A6": "./sound/73.mp3",
                "A#6": "./sound/74.mp3",
                "B6": "./sound/75.mp3",
                "C7": "./sound/76.mp3",
                "C#7": "./sound/77.mp3",
                "D7": "./sound/78.mp3",
                "D#7": "./sound/79.mp3",
                "E7": "./sound/80.mp3",
                "F7": "./sound/87.mp3",
                "F#7": "./sound/82.mp3",
                "G7": "./sound/83.mp3",
                "G#7": "./sound/84.mp3",
                "A7": "./sound/85.mp3",
                "C8": "./sound/86.mp3",
                "C#8": "./sound/87.mp3",
            },// envelope: {
            //     attack: 0.1,    // 소리가 빠르게 시작
            //     decay: 0.3,     // 일정 시간 동안 감소
            //     sustain: 1,     // 지속 시간 최대
            //     release: 3      // 키를 떼면 3초 동안 소리가 서서히 사라짐
            // },
            onload: () => {
                console.log("All samples loaded");
            }
        }).toDestination();
        const keyObject = {
            "1": "C2", "!": "C#2", "2": "D2", "@": "D#2", "3": "E2",
            "4": "F2", "$": "F#2", "5": "G2", "%": "G#2", "6": "A2",
            "^": "A#2", "7": "B2", "8": "C3", "*": "C#3", "9": "D3",
            "(": "D#3", "0": "E3", "q": "F3", "Q": "F#3", "w": "G3",
            "W": "G#3", "e": "A3", "E": "A#3", "r": "B3", "t": "C4",
            "T": "C#4", "y": "D4", "Y": "D#4", "u": "E4", "i": "F4",
            "I": "F#4", "o": "G4", "O": "G#4", "p": "A4", "P": "A#4",
            "a": "B4", "s": "C5", "S": "C#5", "d": "D5", "D": "D#5",
            "f": "E5", "g": "F5", "G": "F#5", "h": "G5", "H": "G#5",
            "j": "A5", "J": "A#5", "k": "B5", "l": "C6", "L": "C#6",
            "z": "D6", "Z": "D#6", "x": "E6", "c": "F6", "C": "F#6",
            "v": "G6", "V": "G#6", "b": "A6", "B": "A#6", "n": "B6",
            "m": "C7", "M": "C#7"
        };
        function isUpperCaseOrSpecialChar(str) {
            const regex = /^[A-Z!@#$%^&*()_+={}\[\]:;"'<>,.?/\\|-]*$/; // 대문자와 특수문자만 허용
            return regex.test(str);
        }
        const keyArray = [
            ['1', '!', '2', '@', '3', '4', '$', '5', '%', '6', '^', '7', '8', '*', '9', '(', '0'],
            ['q', 'Q', 'w', 'W', 'e', 'E', 'r', 't', 'T', 'y', 'Y', 'u', 'i', 'I', 'o', 'O', 'p', 'P'],
            ['a', 's', 'S', 'd', 'D', 'f', 'g', 'G', 'h', 'H', 'j', 'J', 'k', 'l', 'L'],
            ['z', 'Z', 'x', 'c', 'C', 'v', 'V', 'b', 'B', 'n', 'm']];
        const keyFlatArray = keyArray.reduce((acc, cur) => acc.concat(cur), []);
        const keyMap = keyFlatArray.reduce((acc, item) => {
            acc[item] = false;
            return acc;
        }, {});

        // console.log(keyMap);
        // console.log(keyArray);
        // console.log(keyFlatArray);

        const root = document.getElementById('root');
        for (let i = 0; i < keyFlatArray.length; i++) {
            // console.log(keyFlatArray[i]);
            var line = document.createElement('div');
            if (isUpperCaseOrSpecialChar(keyFlatArray[i])) {
                line.style.backgroundColor = 'lightgray';
            }
            line.className = 'line';
            let lineInfo = document.createElement("div");
            lineInfo.className = 'line-info';
            lineInfo.innerHTML = keyFlatArray[i];
            if (isUpperCaseOrSpecialChar(keyFlatArray[i])) {
                lineInfo.style.backgroundColor = 'black';
                lineInfo.style.color = 'white';
            } else {
                lineInfo.style.backgroundColor = 'white';
                lineInfo.style.color = 'black';
            }
            line.appendChild(lineInfo);
            line.id = `line-${keyFlatArray[i]}`;
            root.appendChild(line);
        }
        document.addEventListener("keydown", function (e) {
            try {

                keyMap[e.key] = true;
                if (!e.repeat) {
                    sampler.triggerAttack(keyObject[e.key]);
                }
            } catch (x) {
                console.log(x);
            }

        });
        document.addEventListener('keyup', function (e) {
            try {

                keyMap[e.key] = false;
                sampler.triggerRelease(keyObject[e.key]);
            } catch (x) {
                console.log(x);
            }

        })
        function createNote(lineNumber) {
            // console.log(lineNumber);
            var line = document.getElementById('line-' + lineNumber);
            var note = document.createElement('div');
            note.className = 'note';
            line.appendChild(note);
        }
        setInterval(function () {
            // console.log(keyMap);
            let keys = Object.keys(keyMap);
            for (let i = 0; i < keys.length; i++) {
                if (keyMap[keys[i]] == true) {
                    createNote(keys[i]);
                }
            }
        }, 25);
    </script>
</body>

</html>